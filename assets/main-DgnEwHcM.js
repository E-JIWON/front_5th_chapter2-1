import"./modulepreload-polyfill-B5Qt9EMX.js";const w=()=>{const t={id:"p1",name:"상품1",price:1e4,stock:50},c={id:"p2",name:"상품2",price:2e4,stock:30},a={id:"p3",name:"상품3",price:3e4,stock:20},o={id:"p4",name:"상품4",price:15e3,stock:0},e={id:"p5",name:"상품5",price:25e3,stock:10},n={p1:t,p2:c,p3:a,p4:o,p5:e},s=i=>n[i]||null;return{p1:t,p2:c,p3:a,p4:o,p5:e,getProduct:s,getStock:i=>{const p=s(i);return p?p.stock:null},hasEnoughStock:(i,p=1)=>{const d=s(i);return d&&d.stock>=p},updateStock:(i,p)=>{const d=s(i);return d?(d.stock+=p,!0):!1},decreaseStock:(i,p=1)=>{const d=s(i);return!d||d.stock<p?!1:(d.stock-=p,!0)},increaseStock:(i,p=1)=>{const d=s(i);return d?(d.stock+=p,!0):!1},updatePrice:(i,p)=>{const d=s(i);return d?(d.price=p,!0):!1},getAllProducts:()=>Object.values(n).map(i=>({...i}))}},l=w(),T=t=>{setTimeout(function(){setInterval(function(){const a=l.getAllProducts().filter(o=>l.hasEnoughStock(o.id));if(a.length>0&&Math.random()<.3){const o=a[Math.floor(Math.random()*a.length)],e=Math.round(o.price*.8);l.updatePrice(o.id,e),alert("번개세일! "+o.name+"이(가) 20% 할인 중입니다!")}},3e4)},Math.random()*1e4),setTimeout(function(){setInterval(function(){const c=l.getLastSelected();if(c){const o=l.getAllProducts().filter(e=>e.id!==c&&l.hasEnoughStock(e.id));if(o.length>0){const e=o[Math.floor(Math.random()*o.length)],n=Math.round(e.price*.95);l.updatePrice(e.id,n),alert(e.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!")}}},6e4)},Math.random()*2e4)},q=()=>{const t=new Set;return{subscribe:o=>t.add(o),notify:()=>t.forEach(o=>o())}},B=t=>{const{subscribe:c,notify:a}=q();let o={...t};return{getState:()=>({...o}),setState:s=>{o={...o,...s},a()},subscribe:c}},b=B({items:[]}),M=()=>{let t=0,c=0,a=0,o=0;return{getTotalAmount:()=>t,getItemCount:()=>c,getBonusPoints:()=>a,getDiscountRate:()=>o,setTotalAmount:e=>{t=e},setItemCount:e=>{c=e},setBonusPoints:e=>{a=e},setDiscountRate:e=>{o=e},reset:()=>{t=0,c=0,a=0,o=0}}},g=M(),A=()=>{let t=null;return{getLastSelected:()=>t,setLastSelected:e=>{t=e},addToCart:e=>{const n=e.value,s=l.getProduct(n);if(s&&l.hasEnoughStock(n)){const u=document.getElementById(n);if(u){const m=u.querySelector("span").textContent,h=parseInt(m.split("x ")[1])+1;l.hasEnoughStock(n,1)?(u.querySelector("span").textContent=m.split("x ")[0]+"x "+h,l.decreaseStock(n)):alert("재고가 부족합니다.")}else{const{items:m}=b.getState(),r=[...m,{...s,quantity:1}];b.setState({items:r}),l.decreaseStock(n)}return t=n,!0}return!1},calculateCart:(e,n,s,u)=>{g.reset();const m=g.getItemCount,r=g.getTotalAmount,h=g.getDiscountRate,f=g.setItemCount,k=g.setTotalAmount,E=g.setDiscountRate,i=g.setBonusPoints,p=e.children;let d=0;if(p.length>0){for(let C=0;C<p.length;C++){const y=p[C],v=y.id,S=l.getProduct(v);if(!S)continue;const I=parseInt(y.querySelector("span").textContent.split("x ")[1]),P=S.price*I;let x=0;I>=10&&(S.id==="p1"?x=.1:S.id==="p2"?x=.15:S.id==="p3"?x=.2:S.id==="p4"?x=.05:S.id==="p5"&&(x=.25)),f(m()+I),d+=P,k(r()+P*(1-x))}if(m()>=30){const C=r()*.25,y=d-r();C>y?(k(d*(1-.25)),E(.25)):E((d-r())/d)}else E((d-r())/d);if(new Date().getDay()===2){k(r()*.9);const C=h()||0;E(Math.max(C,.1))}}i(Math.floor(r()/1e3)),n&&(n.updateTotal(r(),h()),n.updateBonusPoints()),s&&s.updateStockInfo(),u&&u.updateOptions()},handleCartItemChange:e=>{const n=e.target;if(n.classList.contains("quantity-change")||n.classList.contains("remove-item")){const s=n.dataset.productId,u=document.getElementById(s);if(!l.getProduct(s)||!u)return;if(n.classList.contains("quantity-change")){const r=parseInt(n.dataset.change),f=parseInt(u.querySelector("span").textContent.split("x ")[1])+r;f>0&&r>0?l.hasEnoughStock(s,1)?(u.querySelector("span").textContent=u.querySelector("span").textContent.split("x ")[0]+"x "+f,l.decreaseStock(s)):alert("재고가 부족합니다."):f>0&&r<0?(u.querySelector("span").textContent=u.querySelector("span").textContent.split("x ")[0]+"x "+f,l.increaseStock(s)):f<=0&&(u.remove(),l.increaseStock(s,Math.abs(r)))}else if(n.classList.contains("remove-item")){const r=parseInt(u.querySelector("span").textContent.split("x ")[1]);l.increaseStock(s,r),u.remove()}}}}},$=()=>{const t=document.createElement("button");return t.id="add-to-cart",t.className="bg-blue-500 text-white px-4 py-2 rounded",t.textContent="추가",{element:t,render:o=>{o.appendChild(t)},setupEventHandler:o=>{t.addEventListener("click",o)}}},L=()=>{const t=document.createElement("div");t.id="cart-items";const c=()=>{t.innerHTML="";const{items:o}=b.getState();o.forEach(e=>{const n=document.createElement("div");n.id=e.id,n.className="flex justify-between items-center mb-2",n.innerHTML=`
          <span>${e.name} - ${e.price}원 x ${e.quantity}</span>
          <div>
            <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${e.id}" data-change="-1">-</button>
            <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${e.id}" data-change="1">+</button>
            <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${e.id}">삭제</button>
          </div>`,t.appendChild(n)})};return{element:t,render:o=>{o.appendChild(t),c(),b.subscribe(c)}}},D=()=>{const t=document.createElement("div");return t.id="cart-total",t.className="text-xl font-bold my-4",{element:t,render:e=>{e.appendChild(t)},updateTotal:(e,n=0)=>{if(t.textContent=`총액: ${Math.round(e)}원`,n>0){const s=document.createElement("span");s.className="text-green-500 ml-2",s.textContent=`(${(n*100).toFixed(1)}% 할인 적용)`,t.appendChild(s)}},updateBonusPoints:()=>{const e=g.getBonusPoints;let n=document.getElementById("loyalty-points");n||(n=document.createElement("span"),n.id="loyalty-points",n.className="text-blue-500 ml-2",t.appendChild(n)),n.textContent=`(포인트: ${e()})`}}},N=()=>{const t=document.createElement("div"),c=document.createElement("div"),a=document.createElement("h1");return t.className="bg-gray-100 p-8",c.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",a.className="text-2xl font-bold mb-4",a.textContent="장바구니",t.appendChild(c),c.appendChild(a),{wrapperEl:c,render:e=>{e.appendChild(t)}}},Q=()=>{const t=document.createElement("select");t.id="product-select",t.className="border rounded p-2 mr-2";const c=()=>{t.innerHTML="",l.getAllProducts().forEach(e=>{let n=document.createElement("option");n.value=e.id,n.textContent=e.name+" - "+e.price+"원",l.hasEnoughStock(e.id)||(n.disabled=!0),t.appendChild(n)})};return{element:t,updateOptions:c,render:o=>{o.appendChild(t),c()}}},H=()=>{const t=document.createElement("div");return t.id="stock-status",t.className="text-sm text-gray-500 mt-2",{element:t,render:o=>{o.appendChild(t)},updateStockInfo:()=>{let o="";l.getAllProducts().forEach(function(n){n.stock<5&&(o+=`${n.name}: ${n.stock>0?`재고 부족 (${n.stock}개 남음)`:"품절"}
`)}),t.textContent=o}}};function R(){const t=document.getElementById("app"),c=A(),a=N();a.render(t);const o=L();o.render(a.wrapperEl);const e=o.element,n=D();n.render(a.wrapperEl);const s=Q();s.render(a.wrapperEl);const u=s.element,m=$();m.render(a.wrapperEl);const r=H();r.render(a.wrapperEl),e.addEventListener("click",h=>{c.handleCartItemChange(h,e),c.calculateCart(e,n,r,s)}),m.setupEventHandler(()=>{c.addToCart(u),c.setLastSelected(u.value),c.calculateCart(e,n,r,s)}),c.calculateCart(e,n,r),T()}R();
