import"./modulepreload-polyfill-B5Qt9EMX.js";const v=()=>{const t={id:"p1",name:"상품1",price:1e4,stock:50},s={id:"p2",name:"상품2",price:2e4,stock:30},a={id:"p3",name:"상품3",price:3e4,stock:20},c={id:"p4",name:"상품4",price:15e3,stock:0},e={id:"p5",name:"상품5",price:25e3,stock:10},n={p1:t,p2:s,p3:a,p4:c,p5:e},o=i=>n[i]||null;return{p1:t,p2:s,p3:a,p4:c,p5:e,getProduct:o,getStock:i=>{const p=o(i);return p?p.stock:null},hasEnoughStock:(i,p=1)=>{const l=o(i);return l&&l.stock>=p},updateStock:(i,p)=>{const l=o(i);return l?(l.stock+=p,!0):!1},decreaseStock:(i,p=1)=>{const l=o(i);return!l||l.stock<p?!1:(l.stock-=p,!0)},increaseStock:(i,p=1)=>{const l=o(i);return l?(l.stock+=p,!0):!1},updatePrice:(i,p)=>{const l=o(i);return l?(l.price=p,!0):!1},getAllProducts:()=>Object.values(n).map(i=>({...i}))}},d=v(),w=t=>{setTimeout(function(){setInterval(function(){const a=d.getAllProducts().filter(c=>d.hasEnoughStock(c.id));if(a.length>0&&Math.random()<.3){const c=a[Math.floor(Math.random()*a.length)],e=Math.round(c.price*.8);d.updatePrice(c.id,e),alert("번개세일! "+c.name+"이(가) 20% 할인 중입니다!")}},3e4)},Math.random()*1e4),setTimeout(function(){setInterval(function(){const s=d.getLastSelected();if(s){const c=d.getAllProducts().filter(e=>e.id!==s&&d.hasEnoughStock(e.id));if(c.length>0){const e=c[Math.floor(Math.random()*c.length)],n=Math.round(e.price*.95);d.updatePrice(e.id,n),alert(e.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!")}}},6e4)},Math.random()*2e4)},T=()=>{let t=0,s=0,a=0,c=0;return{getTotalAmount:()=>t,getItemCount:()=>s,getBonusPoints:()=>a,getDiscountRate:()=>c,setTotalAmount:e=>{t=e},setItemCount:e=>{s=e},setBonusPoints:e=>{a=e},setDiscountRate:e=>{c=e},reset:()=>{t=0,s=0,a=0,c=0}}},h=T(),B=()=>{let t=null;return{getLastSelected:()=>t,setLastSelected:e=>{t=e},addToCart:(e,n)=>{const o=e.value,u=d.getProduct(o);if(u&&d.hasEnoughStock(o)){const m=document.getElementById(o);if(m){const r=m.querySelector("span").textContent,g=parseInt(r.split("x ")[1])+1;d.hasEnoughStock(o,1)?(m.querySelector("span").textContent=r.split("x ")[0]+"x "+g,d.decreaseStock(o)):alert("재고가 부족합니다.")}else{const r=document.createElement("div");r.id=o,r.className="flex justify-between items-center mb-2",r.innerHTML=`
          <span>${u.name} - ${u.price}원 x 1</span>
          <div>
            <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${o}" data-change="-1">-</button>
            <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${o}" data-change="1">+</button>
            <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${o}">삭제</button>
          </div>`,n.appendChild(r),d.decreaseStock(o)}return t=o,!0}return!1},calculateCart:(e,n,o,u)=>{h.reset();const m=h.getItemCount,r=h.getTotalAmount,f=h.getDiscountRate,g=h.setItemCount,E=h.setTotalAmount,S=h.setDiscountRate,i=h.setBonusPoints,p=e.children;let l=0;if(p.length>0){for(let C=0;C<p.length;C++){const y=p[C],b=y.id,x=d.getProduct(b);if(!x)continue;const P=parseInt(y.querySelector("span").textContent.split("x ")[1]),I=x.price*P;let k=0;P>=10&&(x.id==="p1"?k=.1:x.id==="p2"?k=.15:x.id==="p3"?k=.2:x.id==="p4"?k=.05:x.id==="p5"&&(k=.25)),g(m()+P),l+=I,E(r()+I*(1-k))}if(m()>=30){const C=r()*.25,y=l-r();C>y?(E(l*(1-.25)),S(.25)):S((l-r())/l)}else S((l-r())/l);if(new Date().getDay()===2){E(r()*.9);const C=f()||0;S(Math.max(C,.1))}}i(Math.floor(r()/1e3)),n&&(n.updateTotal(r(),f()),n.updateBonusPoints()),o&&o.updateStockInfo(),u&&u.updateOptions()},handleCartItemChange:e=>{const n=e.target;if(n.classList.contains("quantity-change")||n.classList.contains("remove-item")){const o=n.dataset.productId,u=document.getElementById(o);if(!d.getProduct(o)||!u)return;if(n.classList.contains("quantity-change")){const r=parseInt(n.dataset.change),g=parseInt(u.querySelector("span").textContent.split("x ")[1])+r;g>0&&r>0?d.hasEnoughStock(o,1)?(u.querySelector("span").textContent=u.querySelector("span").textContent.split("x ")[0]+"x "+g,d.decreaseStock(o)):alert("재고가 부족합니다."):g>0&&r<0?(u.querySelector("span").textContent=u.querySelector("span").textContent.split("x ")[0]+"x "+g,d.increaseStock(o)):g<=0&&(u.remove(),d.increaseStock(o,Math.abs(r)))}else if(n.classList.contains("remove-item")){const r=parseInt(u.querySelector("span").textContent.split("x ")[1]);d.increaseStock(o,r),u.remove()}}}}},M=()=>{const t=document.createElement("button");return t.id="add-to-cart",t.className="bg-blue-500 text-white px-4 py-2 rounded",t.textContent="추가",{element:t,render:c=>{c.appendChild(t)},setupEventHandler:c=>{t.addEventListener("click",c)}}},q=()=>{const t=document.createElement("div");return t.id="cart-items",{element:t,render:a=>{a.appendChild(t)}}},A=()=>{const t=document.createElement("div");return t.id="cart-total",t.className="text-xl font-bold my-4",{element:t,render:e=>{e.appendChild(t)},updateTotal:(e,n=0)=>{if(t.textContent=`총액: ${Math.round(e)}원`,n>0){const o=document.createElement("span");o.className="text-green-500 ml-2",o.textContent=`(${(n*100).toFixed(1)}% 할인 적용)`,t.appendChild(o)}},updateBonusPoints:()=>{const e=h.getBonusPoints;let n=document.getElementById("loyalty-points");n||(n=document.createElement("span"),n.id="loyalty-points",n.className="text-blue-500 ml-2",t.appendChild(n)),n.textContent=`(포인트: ${e()})`}}},$=()=>{const t=document.createElement("div"),s=document.createElement("div"),a=document.createElement("h1");return t.className="bg-gray-100 p-8",s.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",a.className="text-2xl font-bold mb-4",a.textContent="장바구니",t.appendChild(s),s.appendChild(a),{wrapperEl:s,render:e=>{e.appendChild(t)}}},L=()=>{const t=document.createElement("select");t.id="product-select",t.className="border rounded p-2 mr-2";const s=()=>{t.innerHTML="",d.getAllProducts().forEach(e=>{let n=document.createElement("option");n.value=e.id,n.textContent=e.name+" - "+e.price+"원",d.hasEnoughStock(e.id)||(n.disabled=!0),t.appendChild(n)})};return{element:t,updateOptions:s,render:c=>{c.appendChild(t),s()}}},D=()=>{const t=document.createElement("div");return t.id="stock-status",t.className="text-sm text-gray-500 mt-2",{element:t,render:c=>{c.appendChild(t)},updateStockInfo:()=>{let c="";d.getAllProducts().forEach(function(n){n.stock<5&&(c+=`${n.name}: ${n.stock>0?`재고 부족 (${n.stock}개 남음)`:"품절"}
`)}),t.textContent=c}}};function N(){const t=document.getElementById("app"),s=B(),a=$();a.render(t);const c=q();c.render(a.wrapperEl);const e=c.element,n=A();n.render(a.wrapperEl);const o=L();o.render(a.wrapperEl);const u=o.element,m=M();m.render(a.wrapperEl);const r=D();r.render(a.wrapperEl),e.addEventListener("click",f=>{s.handleCartItemChange(f,e),s.calculateCart(e,n,r,o)}),m.setupEventHandler(()=>{s.addToCart(u,e),s.setLastSelected(u.value),s.calculateCart(e,n,r,o)}),s.calculateCart(e,n,r),w()}N();
